# 1D Riemann Problems Workflow

Comprehensive benchmark suite for testing SPH methods on exact 1D Riemann problems.

## Test Cases

### Test 1: Sod Shock Tube (Standard)
**Reference:** Sod (1978)

- **Left state:**  ρ=1.0, P=1.0, u=0.0
- **Right state:** ρ=0.125, P=0.1, u=0.0  
- **Features:** Rarefaction wave, contact discontinuity, shock wave
- **End time:** 0.12

Classic test for basic shock capturing capability.

### Test 2: Double Rarefaction (123 Problem)
**Reference:** Toro (2009)

- **Left state:**  ρ=1.0, P=0.4, u=-2.0
- **Right state:** ρ=1.0, P=0.4, u=2.0
- **Features:** Two symmetric rarefaction waves, low density region
- **End time:** 0.15

Tests expansion capability and low density handling.

### Test 3: Strong Shock
**Reference:** Woodward & Colella (1984)

- **Left state:**  ρ=1.0, P=1000.0, u=0.0
- **Right state:** ρ=1.0, P=0.01, u=0.0
- **Features:** Very strong shock (Mach ~100), extreme pressure ratio
- **End time:** 0.012

Challenges numerical stability and shock capturing at high Mach numbers.

### Test 5: Vacuum Generation
**Reference:** Toro (2009)

- **Left state:**  ρ=1.0, P=1.0, u=-1.0
- **Right state:** ρ=1.0, P=1.0, u=1.0
- **Features:** Vacuum region formation between two rarefaction waves
- **End time:** 0.08

Tests vacuum handling (density → 0).

## Running the Workflow

### Build the Plugin

```bash
cd /Users/guo/OSS/sphcode/build
cmake ..
ninja riemann_plugin
```

### Run Individual Tests

```bash
# Test 1: Sod shock tube
./sph1d --config simulations/workflows/riemann_problems_workflow/01_simulation/configs/test1_sod.json

# Test 2: Double rarefaction
./sph1d --config simulations/workflows/riemann_problems_workflow/01_simulation/configs/test2_rarefaction.json

# Test 3: Strong shock
./sph1d --config simulations/workflows/riemann_problems_workflow/01_simulation/configs/test3_strong.json

# Test 5: Vacuum generation
./sph1d --config simulations/workflows/riemann_problems_workflow/01_simulation/configs/test5_vacuum.json
```

### Analyze Results

```bash
cd simulations/workflows/riemann_problems_workflow/01_simulation
python scripts/analyze_all_tests.py
```

This will:
- Compare each test against exact Riemann solver solutions
- Generate comparison plots showing SPH vs analytical solutions
- Compute L2 errors for density, velocity, pressure, and energy
- Save results to `comparison_results/`

## Output

For each test, the analysis produces:
- **Comparison plots:** 4-panel figures showing ρ, v, P, e at multiple times
- **L2 error metrics:** Relative L2 errors for each variable
- **Summary statistics:** Average errors across all timesteps

## Expected Results

Typical L2 errors for SPH on these problems:

| Test | Density Error | Velocity Error | Pressure Error |
|------|---------------|----------------|----------------|
| 1 (Sod) | 0.10-0.20 | 0.10-0.20 | 0.15-0.25 |
| 2 (Rarefaction) | 0.05-0.15 | 0.05-0.15 | 0.10-0.20 |
| 3 (Strong) | 0.20-0.40 | 0.15-0.30 | 0.25-0.50 |
| 5 (Vacuum) | 0.15-0.30 | 0.10-0.25 | 0.20-0.40 |

## References

1. **Sod, G. A.** (1978). "A survey of several finite difference methods for systems of nonlinear hyperbolic conservation laws." *Journal of Computational Physics*, 27(1), 1-31.

2. **Toro, E. F.** (2009). *Riemann Solvers and Numerical Methods for Fluid Dynamics: A Practical Introduction*. Springer.

3. **Woodward, P., & Colella, P.** (1984). "The numerical simulation of two-dimensional fluid flow with strong shocks." *Journal of Computational Physics*, 54(1), 115-173.

4. **Yuasa, F., & Mori, M.** (2023). "Novel Hydrodynamic Schemes Capturing Shocks and Contact Discontinuities." *arXiv:2312.03224*.

## Files

```
riemann_problems_workflow/
├── 01_simulation/
│   ├── CMakeLists.txt              # Build configuration
│   ├── src/
│   │   └── plugin.cpp              # Riemann problems initialization
│   ├── configs/
│   │   ├── test1_sod.json          # Sod shock tube config
│   │   ├── test2_rarefaction.json  # Double rarefaction config
│   │   ├── test3_strong.json       # Strong shock config
│   │   └── test5_vacuum.json       # Vacuum generation config
│   ├── scripts/
│   │   └── analyze_all_tests.py    # Analysis and visualization
│   └── README.md                   # This file
└── comparison_results/             # Generated by analysis script
    ├── test1_sod_comparison.png
    ├── test2_rarefaction_comparison.png
    ├── test3_strong_comparison.png
    └── test5_vacuum_comparison.png
```

## Notes

- All tests use γ=1.4 (ideal diatomic gas)
- Domain: [-0.5, 0.5] with 400 particles
- Interface at x=0
- CSV output with JSON metadata sidecars
- Exact Riemann solver for analytical solutions
